#! /bin/bash

#SBATCH --partition=compute
#SBATCH --job-name=diverstiy_metrics
#SBATCH --mail-type=ALL
#SBATCH --mail-user=jpitt@whoi.edu
#SBATCH --ntasks=2
#SBATCH --nodes=24
#SBATCH --cpus-per-task=1
#SBATCH --mem=20000
#SBATCH --time=2:00:00 
#SBATCH --output=core_vis_diversity.log
#export OMP_NUM_THREADS=1

#this script calculates a variety of diversity metrics. Outputs are visualizations looking at significance and displaying the similarity of the alpha
#and beta diversity metrics. 

qiime diversity alpha-group-significance \
--i-alpha-diversity ../output/core-metric-results/shannon_vector.qza \
--m-metadata-file ../data/plastic_manifest_1.tsv \
--o-visualization ../output/core-metric-results/shannon_group-sig.qzv

qiime diversity beta-group-significance \
--i-distance-matrix ../output/core-metric-results/unweighted_unifrac_distance_matrix.qza \
--m-metadata-file ../data/plastic_manifest_1.tsv \
--m-metadata-column 'sample type' \
--o-visualization ../output/core-metric-results/unweighted-unifrac-distance-sign.qzv \

qiime emperor plot \
--i-pcoa ../output/core-metric-results/unweighted_unifrac_pcoa_results.qza \
--m-metadata-file ../data/plastic_manifest_1.tsv \
--o-visualization ../output/core-metric-results/unweighted-emperor.qzv

qiime emperor plot \
--i-pcoa ../output/core-metric-results/bray_curtis_pcoa_results.qza \
--m-metadata-file ../data/plastic_manifest_1.tsv \
--o-visualization ../output/core-metric-results/bray_curtis_emperor.qzv
